REGEDIT4

[HKEY_CURRENT_USER\Software\Far2\KeyMacros\Shell\CtrlD]
"Sequence"="%S = CmdLine.Value;\nEsc\n\n$If (APanel.SelCount > 1)\n  clip(3)\n  CtrlShiftIns\n  %Selection = clip(0);\n  clip(4)\n  %Selection = replace(%Selection, chr(13), chr(32));\n  %Selection = replace(%Selection, chr(10), \"\");\n\n  $Text \"mydiff \"\n  $Text %Selection\n  Enter\n$Else\n  clip(5, 2)\n  AltShiftIns\n  %Diffee2 = clip(0);\n  clip(5, 1)\n\n  $If (fsplit(%Diffee2, 0x08) == \".check\")\n    %Base2 = fsplit(%Diffee2, 0x07);\n    %Check2 = %Diffee2;\n    $If (fexist(%Base2 + \"-run.log\")) %Log2 = %Base2 + \"-run.log\"; $End\n    $If (fexist(%Base2 + \"-neg.log\")) %Log2 = %Base2 + \"-neg.log\"; $End\n    $If (fexist(%Base2 + \"-pos.log\")) %Log2 = %Base2 + \"-pos.log\"; $End\n  $Else\n    $If (fsplit(%Diffee2, 0x08) == \".log\")\n      %Base2 = substr(fsplit(%Diffee2, 0x07), 0, -4);\n      $If (fexist(%Base2 + \".check\")) %Check2 = %Base2 + \".check\"; $End\n      %Log2 = %Diffee2;\n    $End\n  $End\n\n  $If (mload(\"%%Diffee1\") && %%Diffee1 != \"\")\n    $Text \"mydiff \"\n    $Text %%Diffee1\n    $Text \" \"\n    $Text %Diffee2\n    %%Diffee1 = \"\";\n    msave(\"%%Diffee1\")\n    Enter\n  $Else\n    $If (%Check2 != 0 && %Log2 != 0)\n      $Text \"mydiff \"\n      $Text %Check2\n      $Text \" \"\n      $Text %Log2\n      %%Diffee1 = \"\";\n      msave(\"%%Diffee1\")\n      Enter\n    $Else\n      %%Diffee1 = %Diffee2;\n      msave(\"%%Diffee1\")\n      Down\n    $End\n  $End\n$End\n\n$Text %S"
"DisableOutput"=dword:00000001
